# Loading and Playing Videos from Firebase Storage

## Setting Up Firebase 

### Installation and Setups

Install Firebase CLI:

MacOS:

```sh
curl -sL https://firebase.tools | bash
```

Log in to Firebase:

```sh
firebase login
```

Then choose a project when prompted.

Install FlutterFire CLI:

```sh
dart pub global activate flutterfire_cli
```


### Flutter Setup

Install the `firebase_core` package:

```sh
flutter pub add firebase_core
```

Configure your APP to use Firebase:

```sh
flutterfire configure
```

Note that a `firebase_options.dart` file is created in the root of your project. This file contains the Firebase configuration for your app. You can use this file to configure Firebase for other platforms.


Now, you also need to initialize Firebase App.
Usually, this is done in the `main.dart` file, but you can do it anywhere you want.

```dart
import 'package:firebase_core/firebase_core.dart';

// The following import is generated by the FlutterFire CLI
import 'firebase_options.dart';

void main() async {
  // Initialize Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  // Run the app
  runApp(const MyApp());
}
```


### References
- https://firebase.google.com/docs/flutter
- https://firebase.google.com/docs/cli#setup_update_cli


## Loading and Playing Videos

I have a video in my default Firebase Storage bucket which is located at `lessons/videos/Yoga #1.mp4`. 
I want to load this video and play it in my app.

```dart
import 'package:flutter/material.dart';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:flutter/services.dart';
import 'package:video_player/video_player.dart';

// Firebase storage instance
final storage = FirebaseStorage.instance;

// Reference to the root of the storage
final storageRef = storage.ref();

// Reference to the yoga lesson videos
final lessonVideosRef = storageRef.child('lessons/videos');

// Reference to the specific video to play
final videoRef = lessonVideosRef.child('Yoga #1.mp4');

class VideoDemo extends StatefulWidget {
  const VideoDemo({super.key});

  @override
  State<VideoDemo> createState() => _VideoDemoState();
}

class _VideoDemoState extends State<VideoDemo> {
  late final Future<void> _initializationFuture;
  late final VideoPlayerController _videoController;

  @override
  void initState() {
    super.initState();

    _initializationFuture = SystemChrome.setPreferredOrientations([
      DeviceOrientation.landscapeLeft,
      DeviceOrientation.landscapeRight,
    ])

        // Load video URL
        .then((_) => videoRef.getDownloadURL())

        // Set the video controller
        .then(
          (String videoUrl) =>
              _videoController = VideoPlayerController.networkUrl(
            Uri.parse(videoUrl),
            videoPlayerOptions: VideoPlayerOptions(mixWithOthers: true),
          )..setLooping(true),
        )

        // Initialize the video controller
        .then((_) => _videoController.initialize())

        // Play the video
        .then((_) => _videoController.play());
  }

  @override
  void dispose() {
    // Dispose the video controller
    // It is important to do this,
    // otherwise the video may continue to play in the background
    _videoController.dispose();

    // Reset the orientation
    SystemChrome.setPreferredOrientations(DeviceOrientation.values);

    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return FutureBuilder(
        future: _initializationFuture,
        builder: (context, snapshot) =>
            snapshot.connectionState == ConnectionState.done
                ? _buildView()
                : const Center(child: CircularProgressIndicator.adaptive()));
  }

  Widget _buildView() {
    return Row(
      crossAxisAlignment: CrossAxisAlignment.center,
      children: [
        Expanded(
          child: AspectRatio(
            aspectRatio: _videoController.value.aspectRatio,
            child: VideoPlayer(_videoController),
          ),
        ),
      ],
    );
  }
}
```

```{note}
It is important to dispose the video controller when the widget is disposed, otherwise the video may continue to play in the background.
```
